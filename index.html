<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contextle — Guess the hidden word from context</title>
  <meta name="description" content="A fresh daily word game: read a few sentences with a blank, then guess the hidden word from context. 6 tries." />

  <!-- Social sharing (Open Graph + Twitter) -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Contextle — Guess the hidden word from context" />
  <meta property="og:description" content="Read a few sentences with a blank, then guess the hidden word from context. 6 tries." />
  <meta property="og:url" content="https://jeanmhuang.github.io/contextle/" />

  <!-- Preferred image hosted on GitHub Pages (add thumbnail.png to your Pages root if possible) -->
  <meta property="og:image" content="https://jeanmhuang.github.io/contextle/thumbnail.png" />
  <meta property="og:image:secure_url" content="https://jeanmhuang.github.io/contextle/thumbnail.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Contextle thumbnail" />

  <!-- Fallback image pointing at GitHub raw (in case Pages copy isn’t present yet) -->
  <meta property="og:image" content="https://raw.githubusercontent.com/jeanmhuang/contextle/main/thumbnail.png" />

  <!-- Twitter card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Contextle — Guess the hidden word from context" />
  <meta name="twitter:description" content="Read a few sentences with a blank, then guess the hidden word from context. 6 tries." />
  <meta name="twitter:image" content="https://jeanmhuang.github.io/contextle/thumbnail.png" />

  <!-- Favicons (reusing thumbnail.png so you get a favicon on desktop & mobile) -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://jeanmhuang.github.io/contextle/thumbnail.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://jeanmhuang.github.io/contextle/thumbnail.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://jeanmhuang.github.io/contextle/thumbnail.png">
  <meta name="msapplication-TileImage" content="https://jeanmhuang.github.io/contextle/thumbnail.png">
  <!-- Legacy hint some scrapers still check -->
  <link rel="image_src" href="https://jeanmhuang.github.io/contextle/thumbnail.png" />

  <style>
    :root {
      --bg: #0b0c10;
      --card: #11131a;
      --ink: #eaf0f6;
      --muted: #9aa6b2;
      --accent: #8dd3ff;
      --good: #6ee7a3;
      --bad: #ff6b6b;
      --warn: #ffd166;
      --focus: #aabbee;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; padding: 24px; display: grid; place-items: center;
      background: radial-gradient(1200px 800px at 20% -10%, #14182a, var(--bg));
      color: var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .app { width: min(760px, 100%); }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 16px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#8dd3ff, #a78bfa); display:grid; place-items:center; box-shadow: var(--shadow); }
    .logo span { font-weight: 800; color:#0b0c10; letter-spacing:.5px; }
    h1 { font-size: clamp(20px, 3vw, 28px); margin: 0; letter-spacing: .4px; }
    .links { display:flex; gap:10px; }
    .btn { appearance: none; border: 1px solid #2a2f3d; background: #161a24; color: var(--ink); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; box-shadow: var(--shadow); }
    .btn:hover { border-color: #394257; }
    .btn.primary { background: linear-gradient(135deg, #8dd3ff, #a78bfa); color:#0b0c10; border-color: transparent; }
    .btn.ghost { background: transparent; border-color: #263046; }
    .btn:focus { outline: 3px solid var(--focus); outline-offset: 2px; }

    .card { background: linear-gradient(180deg, #121623, #0e1119); border: 1px solid #1e2434; border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); }
    .meta { display:flex; flex-wrap: wrap; gap:10px; color: var(--muted); font-size: 14px; margin-bottom: 10px; }

    .sentences { display: grid; gap: 10px; margin: 8px 0 16px; }
    .sent { background: #0c0f17; border: 1px dashed #273049; color: var(--ink); padding: 14px; border-radius: 12px; line-height: 1.4; }
    .sent.locked { opacity: .25; filter: blur(2px); }
    mark { background: transparent; color: var(--accent); font-weight: 700; }

    .row { display:flex; gap:10px; }
    input[type="text"] {
      flex:1; padding: 14px 14px; border-radius: 12px; background:#0d1120; border: 1px solid #242b40; color: var(--ink);
      font-size: 16px;
    }
    input::placeholder { color: #65708a; }
    .tries { color: var(--muted); font-size: 14px; margin-bottom: 10px; }

    .history { display:grid; gap:8px; margin: 16px 0; }
    .guess { display:flex; justify-content: space-between; align-items:center; padding: 10px 12px; border-radius: 10px; border:1px solid #223049; background:#0c0f17; }
    .guess.good { border-color: #1d3b2b; background: #0e1712; }
    .guess.bad { border-color: #3d2222; background: #170e0e; }

    .msg { margin-top: 10px; font-weight:600; }
    .msg.good { color: var(--good); }
    .msg.bad { color: var(--bad); }
    .msg.warn { color: var(--warn); }

    footer { margin-top: 16px; display:flex; flex-wrap: wrap; gap:8px; align-items: center; justify-content: space-between; color: var(--muted); }
    .small { font-size: 12px; }
    dialog { border:none; border-radius: 16px; padding: 0; width:min(560px, 92vw); background:#0f1320; color: var(--ink); box-shadow: var(--shadow); }
    .modal-inner { padding: 18px; }
    dialog::backdrop { background: rgba(3,6,12,.6); backdrop-filter: blur(3px); }
    .kbd { background:#151b2f; border:1px solid #2a3350; padding: 2px 6px; border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; }
    .toggle { display:flex; align-items:center; gap:8px; }
    .switch { width:42px; height:24px; background:#26314d; border-radius:999px; position:relative; transition:.2s; border:1px solid #314066; }
    .switch::after { content:""; position:absolute; width:18px; height:18px; background:#fff; border-radius:50%; top:2px; left:2px; transition:.2s; }
    .switch.on { background:#6ee7a3; }
    .switch.on::after { left:22px; }
    a { color: var(--accent); }
  </style>
</head>
<body>
  <!-- Hidden inline image as extra hint for stubborn crawlers -->
  <img src="https://jeanmhuang.github.io/contextle/thumbnail.png" alt="Contextle thumbnail" width="1200" height="630" style="position:absolute;left:-9999px;top:-9999px;z-index:-1;" aria-hidden="true" />

  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"><span>Cx</span></div>
        <h1>Contextle <span aria-hidden="true">—</span> <span class="small">guess the word from context</span></h1>
      </div>
      <div class="links">
        <button class="btn ghost" id="helpBtn" aria-label="How to play">Help</button>
        <button class="btn ghost" id="statsBtn" aria-label="Stats">Stats</button>
      </div>
    </header>

    <section class="card" role="region" aria-labelledby="todayTitle">
      <div class="meta">
        <div id="todayTitle"><strong>Daily Puzzle</strong> · <span id="dateStr"></span></div>
        <div>Reveals after each miss · <span id="limitStr">6</span> tries</div>
      </div>

      <div class="sentences" id="sentences"></div>

      <div class="tries" id="tries"></div>
      <div class="row" role="group" aria-label="Enter your guess">
        <input id="guess" type="text" placeholder="Type the hidden word…" autocomplete="off" autocapitalize="off" spellcheck="false" />
        <button class="btn primary" id="submit">Guess</button>
      </div>

      <div class="history" id="history" aria-live="polite"></div>
      <div class="msg" id="msg" role="status" aria-live="polite"></div>

      <footer>
        <div class="toggle">
          <div class="switch" id="hardSwitch" role="switch" aria-checked="false" tabindex="0" title="Hard mode: must use revealed hints" ></div>
          <span class="small">Hard mode</span>
        </div>
        <div class="small">Made with ❤️ — share your score!
          <button class="btn" id="shareBtn">Share</button>
        </div>
      </footer>
    </section>
  </div>

  <dialog id="help">
    <div class="modal-inner">
      <h2>How to play</h2>
      <p>You're given sentences where a single word is hidden as <span class="kbd">_____</span>. Guess the word. After each wrong guess, another sentence appears using the <em>same</em> word in a different context. You have <strong>6</strong> tries.</p>
      <ul>
        <li>Spelling must be exact. Hyphen/space variants (e.g., “check out” vs “checkout”) use the canonical dictionary form.</li>
        <li>Hard mode enforces: once a letter count is revealed, your guesses must match that length.</li>
        <li>All words are common English words with multiple meanings.</li>
      </ul>
      <button class="btn" onclick="document.getElementById('help').close()">Close</button>
    </div>
  </dialog>

  <dialog id="stats">
    <div class="modal-inner">
      <h2>Your stats</h2>
      <div id="statsBody"></div>
      <button class="btn" onclick="document.getElementById('stats').close()">Close</button>
    </div>
  </dialog>

  <script>
  // --- Small utility: daily index from UTC date ---
  function ymdUTC(d=new Date()){
    return d.toISOString().slice(0,10); // YYYY-MM-DD
  }
  function dailyIndex(mod){
    const [y,m,day] = ymdUTC().split('-').map(Number);
    // simple hash
    let n = y*10000 + m*100 + day;
    n = (n ^ 0x5a5a5a) + (n<<3);
    return Math.abs(n) % mod;
  }

  // --- Puzzles: target word + sentences (blanks indicated by _____) ---
  const PUZZLES = [
    {
      word: "charge",
      s: [
        "The phone won't hold a _____ for more than an hour.",
        "The knight led a fearless _____ across the field.",
        "May I _____ this expense to the client account?",
        "She felt a sudden _____ of excitement in the crowd.",
        "What's the monthly _____ for this service?",
        "The police dropped the _____ after reviewing the footage."
      ]
    },
    {
      word: "pitch",
      s: [
        "He perfected the sales _____ before meeting investors.",
        "The singer can hit perfect _____ even without a tuner.",
        "The roof's steep _____ makes it hard to climb.",
        "They set up the tent and began to _____ camp by dusk.",
        "Tar gave the planks a thick coat of _____.",
        "The crowd's excitement rose to a fever _____."
      ]
    },
    {
      word: "light",
      s: [
        "Please turn on the _____; it's getting dark.",
        "She travels _____ and never checks a bag.",
        "The feather was so _____ it floated on the breeze.",
        "The report casts new _____ on the mystery.",
        "Be sure to _____ the candle from the short wick.",
        "In a different _____, his actions seem understandable."
      ]
    },
    {
      word: "draft",
      s: [
        "Close the window—there's a cold _____.",
        "Please send me a _____ of the email before you publish.",
        "They decided to _____ the new players tomorrow.",
        "The artist made a quick pencil _____ of the scene.",
        "The bar serves local beer on _____.",
        "The policy is still in _____ form."
      ]
    },
    {
      word: "spring",
      s: [
        "Wildflowers bloom in early _____.",
        "The mattress has a broken _____.",
        "They might _____ a surprise on us.",
        "Fresh water bubbles from the mountain _____.",
        "Don't forget to _____ forward the clocks in March.",
        "He can _____ back quickly after setbacks."
      ]
    },
    {
      word: "scale",
      s: [
        "We need to _____ this app to support a million users.",
        "The lizard shed a tiny _____.",
        "Please step on the _____ for your weigh-in.",
        "The map uses a 1:50,000 _____.",
        "Musicians practice the C major _____ every day.",
        "Grease had built up on the fan as a layer of _____."
      ]
    },
    {
      word: "bound",
      s: [
        "The package is _____ for New York by morning.",
        "They are honor-_____ to keep the secret.",
        "He took a running _____ across the stream.",
        "Her joy knew no _____.",
        "The books were _____ in blue leather.",
        "The contract will legally _____ both parties."
      ]
    },
    {
      word: "current",
      s: [
        "Swim across the river with the _____, not against it.",
        "Are you up to date with the _____ events?",
        "The device draws very little _____.",
        "This is the most _____ version of the document.",
        "The warm ocean _____ affects the climate here.",
        "Measure the voltage and the _____ to calculate power."
      ]
    },
    {
      word: "table",
      s: [
        "Please set the _____ for dinner.",
        "Let's _____ that discussion until next week.",
        "The results are summarized in the following _____.",
        "He tried to _____ the motion in parliament.",
        "They negotiated at the _____ late into the night.",
        "Salt was spilled across the wooden _____."
      ]
    },
    {
      word: "season",
      s: [
        "What's your favorite _____ of the year?",
        "Make sure to _____ the soup with salt and pepper.",
        "Fashion changes every _____.",
        "Hurricane _____ starts in early summer.",
        "We _____ the cast-iron pan before using it.",
        "The team hopes to win the championship this _____."
      ]
    }
  ];

  // --- Game state ---
  const MAX_TRIES = 6;
  const hardModeKey = 'cx.hard';
  const statsKey = 'cx.stats';
  const playedKey = 'cx.played.' + ymdUTC(); // ensures one play/day (but you can refresh to view)

  const S = {
    idx: dailyIndex(PUZZLES.length),
    revealed: 1,
    guesses: [],
    done: false,
    hard: JSON.parse(localStorage.getItem(hardModeKey) || 'false'),
    stats: JSON.parse(localStorage.getItem(statsKey) || '{"played":0,"wins":0,"streak":0,"maxStreak":0,"dist":[0,0,0,0,0,0,0]}')
  };

  const today = PUZZLES[S.idx];

  // --- DOM helpers ---
  const el = id => document.getElementById(id);
  el('dateStr').textContent = ymdUTC();
  el('limitStr').textContent = MAX_TRIES;

  function renderSentences(){
    const box = el('sentences');
    box.innerHTML = '';
    today.s.forEach((line, i) => {
      const div = document.createElement('div');
      div.className = 'sent' + (i < S.revealed ? '' : ' locked');
      const hint = i===0 ? ` (letters: ${today.word.length})` : '';
      div.innerHTML = line.replace('_____', '<mark>_____</mark>') + (i===0 ? `<span class="small" style="color:var(--muted)">${hint}</span>` : '');
      box.appendChild(div);
    });
  }

  function renderHistory(){
    const box = el('history');
    box.innerHTML = '';
    S.guesses.forEach(g => {
      const row = document.createElement('div');
      row.className = 'guess ' + (g.ok ? 'good' : 'bad');
      const triesLeft = Math.max(0, MAX_TRIES - g.try);
      row.innerHTML = `<div><strong>${g.text}</strong></div><div class="small">${g.ok ? 'correct' : 'wrong'} · ${triesLeft} left</div>`;
      box.appendChild(row);
    });
  }

  function setMsg(txt, cls=''){
    const m = el('msg');
    m.className = 'msg ' + cls; m.textContent = txt || '';
  }

  function endGame(win){
    S.done = true;
    // update stats once per day play
    if (!localStorage.getItem(playedKey)){
      const st = S.stats;
      st.played++;
      if (win){ st.wins++; st.streak++; st.maxStreak = Math.max(st.maxStreak, st.streak); st.dist[S.guesses.length]++; }
      else { st.streak = 0; st.dist[0]++; }
      localStorage.setItem(statsKey, JSON.stringify(st));
      localStorage.setItem(playedKey, '1');
    }

    // reveal all sentences and answer
    S.revealed = today.s.length;
    renderSentences();

    const reveal = `The word was "${today.word}".`;
    setMsg(win ? `🎉 You got it in ${S.guesses.length}/${MAX_TRIES}! ${reveal}` : `❌ Out of tries. ${reveal}`, win ? 'good' : 'bad');
  }

  function tryGuess(){
    if (S.done) return;
    const inp = el('guess');
    let g = (inp.value || '').trim().toLowerCase();
    if (!g){ setMsg('Type a word to guess.', 'warn'); return; }

    if (S.hard && g.length !== today.word.length){
      setMsg(`Hard mode: guess must be ${today.word.length} letters.`, 'warn');
      return;
    }

    const ok = (g === today.word.toLowerCase());
    S.guesses.push({ text: g, ok, try: S.guesses.length+1 });
    renderHistory();

    if (ok){ endGame(true); return; }

    // wrong
    if (S.guesses.length >= MAX_TRIES){ endGame(false); return; }
    S.revealed = Math.min(today.s.length, S.revealed + 1);
    renderSentences();
    setMsg('Nope — another hint has appeared.', 'warn');
    inp.select();
  }

  function renderStats(){
    const st = S.stats;
    const winPct = st.played ? Math.round(100*st.wins/st.played) : 0;
    const dist = st.dist.map((v,i)=> i===0?`Fails: ${v}`:`${i}: ${v}`).join(' · ');
    el('statsBody').innerHTML = `
      <p><strong>Played:</strong> ${st.played} · <strong>Wins:</strong> ${st.wins} (${winPct}%) · <strong>Streak:</strong> ${st.streak} (max ${st.maxStreak})</p>
      <p><strong>Distribution:</strong> ${dist}</p>
    `;
  }

  function share(){
    const tries = S.guesses.length && S.guesses[S.guesses.length-1].ok ? S.guesses.length : 'X';
    const lines = [];
    const revealCount = Math.min(today.s.length, S.guesses.length + 1);
    for (let i=0;i<revealCount;i++){
      lines.push(i < (typeof tries==='number' ? tries : MAX_TRIES) ? '🟩' : '⬜');
    }
    const text = `Contextle ${tries}/${MAX_TRIES} — ${ymdUTC()}\n` + lines.join('') + `\n` + location.href;
    navigator.clipboard.writeText(text).then(()=> setMsg('Result copied to clipboard!', 'good'))
      .catch(()=> setMsg('Copy failed — you can paste manually.', 'warn'));
  }

  // --- Bindings ---
  renderSentences();
  renderHistory();
  setMsg('Type a word and press Enter.');
  el('tries').textContent = `Tries left: ${MAX_TRIES}`;

  el('submit').addEventListener('click', tryGuess);
  el('guess').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ tryGuess(); } });
  el('helpBtn').addEventListener('click', ()=> el('help').showModal());
  el('statsBtn').addEventListener('click', ()=> { renderStats(); el('stats').showModal(); });
  el('shareBtn').addEventListener('click', share);

  // Hard mode toggle
  const hs = el('hardSwitch');
  function renderHard(){ hs.className = 'switch' + (S.hard ? ' on' : ''); hs.setAttribute('aria-checked', S.hard?'true':'false'); }
  hs.addEventListener('click', ()=>{ S.hard=!S.hard; renderHard(); localStorage.setItem(hardModeKey, JSON.stringify(S.hard)); });
  hs.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); S.hard=!S.hard; renderHard(); localStorage.setItem(hardModeKey, JSON.stringify(S.hard)); }});
  renderHard();

  // Autofocus input
  setTimeout(()=> el('guess').focus(), 50);
  </script>
</body>
</html>

